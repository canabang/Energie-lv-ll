type: custom:stack-in-card
keep:
  background: false
  box_shadow: false
  margin: false
  outer_padding: false
  border_radius: false
cards:
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-title-card
        title: ⚡ PrisLavVais
      #  subtitle: A1Z - Cuisine
      - type: custom:mushroom-entity-card
        entity: sensor.prislavvais_energy
        primary_info: state
        secondary_info: name
        name: Total kWh
        icon: mdi:lightning-bolt-circle
        icon_color: green
        layout: vertical
        card_mod:
          style: |
            ha-card {
              border: none !important;
              box-shadow: none !important;
              background: none !important;
            }
      - type: custom:mushroom-template-card
        primary: "{{ (states('sensor.compteur_prislavvais_total')|float(0) * states('input_number.cout_du_kwh')|float(0)) | round(2) }} €"
        secondary: "Coût ({{ states('input_number.cout_du_kwh') }} €/kWh)"
        icon: mdi:currency-eur
        icon_color: orange
        layout: vertical
        card_mod:
          style: |
            ha-card {
              border: none !important;
              box-shadow: none !important;
              background: none !important;
            }
  - type: custom:mini-graph-card
    entities:
      - entity: sensor.prislavvais_power
        name: Puissance
        color: "#ff9800"
    show:
      graph: line
      fill: true
      labels: true
      name: true
      state: true
      legend: false
      icon: true
      points: true
      extrema: true
      average: true
    line_width: 3
    height: 120
    hours_to_show: 1
    points_per_hour: 60
    hour24: true
    animate: true
    color_thresholds:
      - value: 0
        color: "#4caf50"
      - value: 100
        color: "#ff9800"
      - value: 2000
        color: "#f44336"
    card_mod:
      style: |
        ha-card {
          margin-bottom: 0px !important;
        }

  # --- [NEW] Cycle Monitoring Chips ---
  - type: custom:mushroom-chips-card
    chips:
      - type: template
        entity: sensor.lave_vaisselle_etat
        content: "{{ states('sensor.lave_vaisselle_etat') }}"
        icon: mdi:dishwasher
        icon_color: "{{ 'blue' if is_state('sensor.lave_vaisselle_etat', 'Lavage') else 'grey' }}"
      
      - type: template
        entity: sensor.lave_vaisselle_cout_cycle
        content: "{{ states('sensor.lave_vaisselle_cout_cycle') }} €"
        icon: mdi:currency-eur
        icon_color: green
      
      - type: template
        entity: sensor.lave_vaisselle_duree_cycle
        content: "{{ states('sensor.lave_vaisselle_duree_cycle') }}"
        icon: mdi:clock-outline
      
      - type: template
        entity: sensor.compteur_prislavvais_cycle
        content: "{{ states('sensor.compteur_prislavvais_cycle') }} kWh"
        icon: mdi:flash-outline
    alignment: center
    card_mod:
      style: |
        ha-card {
          --chip-background: none;
          --chip-box-shadow: none;
          --chip-spacing: 8px;
          margin-top: 5px;
          margin-bottom: 5px;
        }

  - type: horizontal-stack
    cards:
      - type: custom:mini-graph-card
        entities:
          - sensor.prislavvais_voltage
        name: Tension
        icon: mdi:sine-wave
        line_color: "#03a9f4"
        line_width: 2
        show:
          graph: line
          fill: fade
          labels: true
          name: true
          state: true
        height: 80
        hours_to_show: 1
        points_per_hour: 10
        hour24: true
        update_interval: 30
        cache: false
        smoothing: false
        lower_bound: 210
        upper_bound: 250
        card_mod:
          style: |
            ha-card {
              border: none !important;
              box-shadow: none !important;
              background: none !important;
            }
      - type: custom:mini-graph-card
        entities:
          - sensor.prislavvais_current
        name: Courant
        icon: mdi:current-ac
        line_color: "#e91e63"
        line_width: 2
        show:
          graph: line
          fill: fade
          labels: true
          icon: true
          name: true
          state: true
        height: 80
        hours_to_show: 1
        points_per_hour: 60
        hour24: true
        card_mod:
          style: |
            ha-card {
              border: none !important;
              box-shadow: none !important;
              background: none !important;
            }
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-template-card
        primary: Prise
        secondary: "{{ states('switch.prislavvais') }}"
        icon: mdi:power-socket-eu
        entity: switch.prislavvais
        icon_color: "{{ 'seagreen' if is_state('switch.prislavvais', 'on') else 'grey' }}"
        layout: horizontal
        tap_action:
          action: toggle
        card_mod:
          style: |
            ha-card {
              background: {{ 'rgba(46, 139, 87, 0.1)' if is_state('switch.prislavvais', 'on') else '' }} !important;
              border: none !important;
            }
      - type: custom:mushroom-chips-card
        chips:
          - type: template
            entity: switch.prislavvais_child_lock
            icon: mdi:cat
            content: >-
              {{ 'Activé' if is_state('switch.prislavvais_child_lock', 'on') else
              'Désactivé' }}
            icon_color: >-
              {{ 'seagreen' if is_state('switch.prislavvais_child_lock', 'on')
              else 'grey' }}
            tap_action:
              action: toggle
        alignment: end
        card_mod:
          style: |
            ha-card {
              margin-top: 12px; 
            }
